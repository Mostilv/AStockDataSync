## Baostock 数据维护策略

### 更新节奏（参考官方发布时间）

- 当日 07:30 前：完成上一交易日 **日线/周线/月线** 入库。
- 当日 08:00 前：完成上一交易日 **复权因子** 入库。
- 次日 01:00 前：完成 **15 分钟 / 60 分钟** K 线入库。
- 次日 09:30 前：完成上一交易日 **其它财务报告数据** 入库。
- 每周六 17:30 前：执行 **周线/月线** 补点与完整性巡检。
- 每周一下午：更新沪深 300、中证 500 等成份股列表。

### 数据范围

| 数据类别 | 时间范围 | 备注 |
| --- | --- | --- |
| 日 / 周 / 月 K 线 | 最近 10 年 | 首次建库按 10 年窗口回补，后续按 `last_*` 增量拉取 |
| 15 分钟 / 60 分钟 K 线 | 2019-01-02 至今 | 固定起始日期，确保分钟级别与官方数据范围一致 |
| 季频财务（资产负债、现金流、利润、杜邦指标） | 最近 10 年 | 同步四套报表，按季度 upsert |

> 说明：指数 K 线默认包含在日/周/月同步中，分钟级别仅对股票执行。

### 增量与巡检

1. **每日增量**
   - `sync_k_data` 根据每个标的的 `last_*_date` 只拉取缺失窗口，分钟线永远以 2019-01-02 为最小值。
   - `sync_finance_data` 以季度为单位增量写入，成功后记录 `last_finance_quarter`。
2. **周末完整性校验**
   - `run_integrity_check` 在周末自动触发，按以下窗口重拉数据并 upsert：
     - 日线 30 天、周线 400 天、月线 1500 天；
     - 15 分钟 15 天、60 分钟 45 天。
   - 若巡检期间发现缺口，会重新写入并刷新 `last_*` 标记。

通过上述策略，可保持 15m/60m 分钟线与官方时间范围一致、日/周/月及季频财务覆盖最近 10 年，并在周末自动查漏补缺，确保 MongoDB 中的数据始终与 baostock 可获取的最新数据对齐。
