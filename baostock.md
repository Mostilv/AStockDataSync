## Baostock 数据维护策略

### 更新节奏（参考官方发布时间）

- 当日 17:30 前：完成当前交易日 **日线** 入库
- 当日 18:00 前：完成当前交易日 **复权因子** 入库
- 次日 01:30 前：完成上一交易日 **其它财务报告数据** 入库
- 次日 11:00 前：完成上一交易日 **5 分钟** K 线入库
- 每周六 17:30 前：完成 **周线** 入库与补点、完整性巡检
- 每周一下午：更新沪深 300、中证 500 等成份股列表

### 数据范围

| 数据类别 | 时间范围 | 备注 |
| --- | --- | --- |
| 日/周/月 K 线 | 最近 3 年 | 首次建库全量回补（近 3 年），后续按 `last_*` 增量 |
| 5 分钟 K 线 | 2019-01-02 起（默认仅近 1 个月） | 固定起点，默认仅回溯 30 天 |
| 季频财务（资产负债、现金流、利润、杜邦） | 最近 10 年 | 按季度 upsert 四套报表 |

> 说明：指数 K 线包含在日/周/月流程中，分钟级仅对股票生效。

### 增量与巡检

1. **每日增量**
   - `sync_k_data` 依据 `last_*_date` 仅抓取缺口，分钟线永远以 2019-01-02 为最小值。
   - `sync_finance_data` 按季度 upsert，并记录 `last_finance_quarter`。
2. **周末完整性校验**
   - `run_integrity_check` 按以下窗口重拉数据并 upsert：
     - 日线 30 天、周线 400 天、月线 1500 天
     - 5 分钟 15 天（默认近 1 个月内的数据）
   - 如发现缺口会重新写入并刷新 `last_*` 标记。

通过以上策略，可维持分钟级和日/周/月数据与官方口径一致，季频财务覆盖最近 10 年，并在周末自动补缺，确保 MongoDB 中数据始终与 baostock 最新可得数据对齐。
